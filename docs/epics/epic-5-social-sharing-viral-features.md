# Epic 5: Social Sharing & Viral Features

**Goal:** Enable users to share their Norwegian songs on social media platforms to drive organic growth.

**User Value:** Users can effortlessly share songs with friends and at events, growing the platform virally.

**FRs Covered:** FR56-FR59 (Social Sharing)

---

### Story 5.1: Create Social Share Sheet Component

As a **user**,
I want a one-tap social sharing menu,
So that I can quickly share my Norwegian song to TikTok, Facebook, or Instagram.

**Acceptance Criteria:**

**Given** I am viewing a completed song
**When** I tap the "Share" button
**Then** A bottom sheet slides up from the bottom of the screen
**And** I see large platform icons (48x48px): TikTok, Facebook, Instagram, WhatsApp, Copy Link
**And** Each icon is touch-friendly and clearly labeled
**And** Song preview card is displayed at top of sheet: Artwork, Title, "Created with Musikkfabrikken"
**And** Tapping a platform icon triggers native share intent
**And** Sheet is dismissible: Swipe down or tap outside

**Prerequisites:** Story 3.8 (Song Player)

**Technical Notes:**
- UX reference: `/docs/ux-design-specification.md` section "6.1 Custom Component: Social Share Sheet"
- Create `/src/components/social-share-sheet.tsx`
- Use shadcn/ui Sheet or Dialog component as base
- Bottom sheet animation: Slide up from bottom (mobile native pattern)
- Platform icons: Use brand colors (TikTok=black, Facebook=blue, Instagram=gradient)
- Native Web Share API: `navigator.share()` for mobile
- Fallback for desktop: Custom share URLs

---

### Story 5.2: Implement TikTok and Facebook Share Functionality

As a **user**,
I want to share my song directly to TikTok or Facebook,
So that my friends can hear my Norwegian creation and discover Musikkfabrikken.

**Acceptance Criteria:**

**Given** I have tapped "Share" and selected TikTok or Facebook
**When** The native share intent opens
**Then** Pre-filled caption appears: "Check out my Norwegian AI song! ðŸŽµ Created with Musikkfabrikken"
**And** Song audio file is attached (or link if direct upload not supported)
**And** Musikkfabrikken branding is visible: Logo watermark on preview image
**And** After sharing, I return to Musikkfabrikken and see confirmation: "âœ“ Shared to {Platform}!"
**And** Share count increments in database for analytics

**Prerequisites:** Story 5.1

**Technical Notes:**
- TikTok: Use TikTok Share SDK or deep link: `tiktok://share`
- Facebook: Use Facebook Share Dialog or deep link: `fb://share`
- Caption template: Customizable, includes attribution
- Audio attachment: Direct file upload if API supports, otherwise shareable link
- Track shares: Increment `shared_count` in `song` table
- Test with actual mobile devices (emulators may not support native intents)

---

### Story 5.3: Generate Shareable Song Links

As a **user**,
I want to generate a shareable link for my song,
So that I can share it via any platform (SMS, email, WhatsApp, etc.).

**Acceptance Criteria:**

**Given** I am in the social share sheet
**When** I tap "Copy Link"
**Then** A shareable URL is copied to clipboard: `musikkfabrikken.no/songs/{songId}`
**And** I see success toast: "âœ“ Link copied to clipboard!"
**And** When someone visits the link
**Then** They see a public song player page with: Artwork, Title, Genre, Play button
**And** Non-logged-in visitors can listen to the song (read-only access)
**And** Page includes Musikkfabrikken branding and "Create your own" CTA
**And** Page has Open Graph meta tags for rich previews (thumbnail, title, description)

**Prerequisites:** Story 5.1

**Technical Notes:**
- Generate shareable UUID or short code for songs
- Create public route: `/src/app/songs/[id]/page.tsx` (no auth required)
- Use RLS policy: Allow SELECT on `song` table for shared songs only
- Add `is_public` boolean column to `song` table (default false, true when shared)
- Open Graph tags: `<meta property="og:title">`, `og:image`, `og:audio`
- Test link sharing on WhatsApp, SMS, email (preview rendering)

---

### Story 5.4: Add Musikkfabrikken Watermark to Free Previews

As a **developer**,
I want free preview clips to include visible Musikkfabrikken branding,
So that shared previews drive awareness and user acquisition.

**Acceptance Criteria:**

**Given** A user generates a free 30-second preview
**When** The preview audio is generated by Suno
**Then** A watermark announcement is added: Voice-over at end saying "Created with Musikkfabrikken"
**OR** Watermark is added as metadata in audio file
**AND** When preview is shared, visual preview image includes Musikkfabrikken logo
**And** Full songs (paid) do NOT include watermark
**And** Watermark is subtle but noticeable (not intrusive)

**Prerequisites:** Story 3.9 (Free Preview), Story 5.1 (Sharing)

**Technical Notes:**
- Option 1: Suno watermark parameter (if supported)
- Option 2: Post-processing audio with ffmpeg: Add voice-over at end
- Option 3: Embed metadata in MP3 ID3 tags: Copyright="Musikkfabrikken.no"
- Visual watermark: Generate share preview image with logo overlay
- Store watermark status in database: `is_watermarked` boolean
- Watermark removal: Only for paid full songs

---

### Story 5.5: Track Share Analytics and Attribution

As a **founder**,
I want to track which users share songs and where,
So that I can measure viral growth and identify top sharers.

**Acceptance Criteria:**

**Given** Users are sharing songs on social platforms
**When** A song is shared via any platform
**Then** A record is created in `song_share` table with: song_id, user_id, platform, shared_at timestamp
**And** Song's `shared_count` is incremented
**And** When a new user signs up via shared link (query param: `?ref={songId}`)
**Then** Referral is tracked: Attribute new user to referring song/user
**And** Founder can view analytics dashboard: Total shares, shares by platform, top shared songs, viral coefficient
**And** Future: Reward top sharers with bonus credits

**Prerequisites:** Story 5.3 (Shareable links)

**Technical Notes:**
- Create `song_share` table: id, song_id, user_id, platform, shared_at
- Increment `song.shared_count` atomically on share
- Add `?ref={songId}` query param to shareable links
- Track referral source in user_profile: `referred_by_song_id`
- Analytics query: Count shares grouped by platform, song, date range
- Future: Implement referral rewards (bonus credits for successful referrals)

---

---
